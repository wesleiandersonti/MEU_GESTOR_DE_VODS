<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LisoFlix Pro</title>
<style>
  @import url("https://fonts.cdnfonts.com/css/netflix-sans");

  :root {
    --netflix-red: #e50914;
    --netflix-black: #000000;
    --netflix-dark-gray: #141414;
    --netflix-medium-gray: #333333;
    --netflix-light-gray: #808080;
    --netflix-white: #ffffff;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    background-color: var(--netflix-black);
    font-family: "Netflix Sans", "Helvetica Neue", Arial, sans-serif;
    color: var(--netflix-white);
    overflow-x: hidden;
  }

  header {
    background-color: rgba(0, 0, 0, 1);
    padding: 14px 4%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 1000;
    transition: background-color 0.3s ease;
  }

  .logo {
    font-size: 1.8em;
    font-weight: bold;
    color: var(--netflix-white);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
    flex-shrink: 0;
  }

  .logo span {
    color: var(--netflix-red);
    font-style: italic;
    transform: skewX(-10deg);
    display: inline-block;
  }

  nav {
    display: flex;
    gap: 14px;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
    flex-grow: 1;
    justify-content: flex-end;
    align-items: center;
  }
  nav::-webkit-scrollbar { display: none; }

  nav button, .config-btn {
    background: none;
    border: none;
    color: var(--netflix-light-gray);
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    padding: 6px 12px;
    border-bottom: 3px solid transparent;
    transition: color 0.3s ease, border-bottom 0.3s ease;
    flex-shrink: 0;
  }

  nav button.active {
    color: var(--netflix-white);
    border-bottom: 3px solid var(--netflix-red);
  }

  .config-btn {
    background: var(--netflix-red);
    color: white;
    border-radius: 4px;
    border: none;
    margin-left: 10px;
  }

  .hero-banner {
    position: relative;
    height: 60vh;
    background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.8)), url("https://image.tmdb.org/t/p/original/xOMo8BRK7PfcJv9JCnx7s5hj0PX.jpg");
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 0 4%;
  }

  .hero-content { max-width: 500px; color: var(--netflix-white); }
  .hero-title { font-size: 3rem; font-weight: bold; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
  .hero-description { font-size: 1.2rem; margin-bottom: 25px; line-height: 1.4; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); }
  .hero-buttons { display: flex; gap: 15px; flex-wrap: wrap; }

  .btn-play, .btn-info, .btn-cast {
    padding: 12px 30px;
    border: none;
    border-radius: 6px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-play { background: var(--netflix-white); color: var(--netflix-black); }
  .btn-play:hover { background: rgba(255,255,255,0.8); }
  .btn-info { background: rgba(109, 109, 110, 0.7); color: var(--netflix-white); }
  .btn-info:hover { background: rgba(109, 109, 110, 0.5); }
  .btn-cast { background: #1a8cff; color: white; }
  .btn-cast:hover { background: #0066cc; }

  .carousel, .grid {
    display: flex;
    flex-wrap: nowrap;
    overflow-x: auto;
    gap: 8px;
    padding: 0 4% 20px 4%;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .carousel::-webkit-scrollbar { display: none; }
  .grid { flex-wrap: wrap; justify-content: center; overflow-x: hidden; }

  .item {
    width: 200px;
    background: transparent;
    border-radius: 8px;
    overflow: hidden;
    text-align: left;
    flex-shrink: 0;
    position: relative;
    transition: transform 0.3s ease;
    cursor: pointer;
  }
  .item:hover { transform: scale(1.08); z-index: 10; }
  .item img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 8px;
    background: var(--netflix-medium-gray);
  }
  .item p { margin: 8px 0; font-size: 0.9rem; color: var(--netflix-light-gray); font-weight: 500; }

  .img-container { position: relative; overflow: hidden; border-radius: 8px; }
  .fav-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 1.4em;
    cursor: pointer;
    text-shadow: 0 0 8px black;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  .fav-btn:hover { background: rgba(0,0,0,0.8); transform: scale(1.1); }

  .category { margin-bottom: 40px; }
  .category h2 { margin: 0 0 15px 4%; font-size: 1.4em; color: var(--netflix-white); font-weight: bold; }

  .loading-spinner {
    display: inline-block;
    width: 40px;
    height: 40px;
    border: 3px solid var(--netflix-medium-gray);
    border-top: 3px solid var(--netflix-red);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

  video {
    width: 100%;
    max-height: 50vh;
    display: none;
    margin-bottom: 10px;
  }

  .player-container {
    position: relative;
    width: 100%;
    background: #000;
    margin-bottom: 20px;
  }

  #player-controls {
    display: none;
    justify-content: center;
    gap: 10px;
    margin: 10px 0;
    flex-wrap: wrap;
    padding: 0 4%;
  }
  #player-controls button {
    background: var(--netflix-red);
    color: var(--netflix-white);
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    font-weight: bold;
    cursor: pointer;
  }

  .episodes button {
    display: block;
    width: 100%;
    margin: 4px 0;
    background: var(--netflix-medium-gray);
    color: var(--netflix-white);
    border: none;
    padding: 10px;
    border-radius: 6px;
    text-align: left;
    cursor: pointer;
  }
  .episodes button:hover { background: #444; }

  .config-modal, .cast-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 2000;
    justify-content: center;
    align-items: center;
  }

  .config-content, .cast-content {
    background: var(--netflix-dark-gray);
    padding: 30px;
    border-radius: 10px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
  }

  .config-content h2, .cast-content h2 {
    color: var(--netflix-red);
    margin-bottom: 20px;
  }

  .config-content input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid var(--netflix-medium-gray);
    background: var(--netflix-black);
    color: white;
    border-radius: 4px;
  }

  .config-content button, .cast-content button {
    padding: 12px 24px;
    background: var(--netflix-red);
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
    margin-right: 10px;
  }

  .cast-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 20px 0;
  }

  .cast-option {
    padding: 15px;
    background: var(--netflix-medium-gray);
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .cast-option:hover { background: #444; }

  .load-more {
    text-align: center;
    padding: 20px;
  }
  .load-more button {
    padding: 10px 30px;
    background: var(--netflix-red);
    color: white;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-weight: bold;
  }

  @media (max-width: 768px) {
    .hero-content { margin-left: 0; }
    .hero-title { font-size: 2rem; }
    .hero-description { font-size: 1rem; }
    .carousel, .grid { padding: 0 20px 20px 20px; }
    .category h2 { margin: 0 0 15px 20px; }
    .item { width: 150px; }
    .item img { height: 225px; }
  }
</style>
</head>
<body>

<header id="header">
  <div class="logo"><span>L</span>iso<span>F</span>lix <span style="font-size: 0.5em; color: #666;">PRO</span></div>
  <nav>
    <button id="tab-home" class="active">In√≠cio</button>
    <button id="tab-filmes">Filmes</button>
    <button id="tab-series">S√©ries</button>
    <button id="tab-favoritos">Favoritos</button>
    <button class="config-btn" onclick="openConfig()">‚öôÔ∏è Config</button>
  </nav>
</header>

<div class="player-container">
  <video controls id="player"></video>
  <div id="player-controls">
    <button onclick="playerPlay()">‚ñ∂Ô∏è Play</button>
    <button onclick="playerPause()">‚è∏Ô∏è Pause</button>
    <button onclick="playerStop()">‚èπÔ∏è Stop</button>
    <button onclick="playerBack()">‚è™ -10s</button>
    <button onclick="playerForward()">‚è© +10s</button>
    <button onclick="openCastModal()">üì∫ Reproduzir na TV</button>
  </div>
</div>

<div id="conteudo">
  <div style="text-align: center; padding: 50px;"><div class="loading-spinner"></div></div>
</div>

<div id="configModal" class="config-modal">
  <div class="config-content">
    <h2>‚öôÔ∏è Configura√ß√£o da API</h2>
    <p style="color: #aaa; margin-bottom: 20px;">Digite as credenciais do seu servidor IPTV:</p>
    <input type="text" id="config-url" placeholder="URL do servidor (ex: https://seuservidor.com)" />
    <input type="text" id="config-user" placeholder="Usu√°rio" />
    <input type="password" id="config-pass" placeholder="Senha" />
    <div style="margin-top: 20px;">
      <button onclick="saveConfig()">üíæ Salvar</button>
      <button onclick="closeConfig()" style="background: #444;">Cancelar</button>
    </div>
  </div>
</div>

<div id="castModal" class="cast-modal">
  <div class="cast-content">
    <h2>üì∫ Reproduzir em Dispositivo</h2>
    <p style="color: #aaa; margin-bottom: 20px;">Escolha como reproduzir:</p>
    <div class="cast-options">
      <div class="cast-option" onclick="castToLocalNetwork()">
        <strong>üè† Reproduzir na Rede Local</strong>
        <p style="font-size: 0.9em; color: #aaa;">Abrir player em dispositivo na mesma rede (localhost)</p>
      </div>
      <div class="cast-option" onclick="copyStreamUrl()">
        <strong>üìã Copiar Link do Stream</strong>
        <p style="font-size: 0.9em; color: #aaa;">Copiar URL para usar em outro player</p>
      </div>
      <div class="cast-option" onclick="generateQR()">
        <strong>üì± Gerar QR Code</strong>
        <p style="font-size: 0.9em; color: #aaa;">Escanear com celular para reproduzir</p>
      </div>
    </div>
    <button onclick="closeCastModal()" style="background: #444; width: 100%;">Fechar</button>
  </div>
</div>

<script>
  // Configura√ß√£o via localStorage
  const CONFIG_KEY = 'lisoflix_config';
  let config = JSON.parse(localStorage.getItem(CONFIG_KEY)) || {};
  
  // Vari√°veis globais
  let filmes = {};
  let series = {};
  let streamBase = "";
  let favoritos = JSON.parse(localStorage.getItem("favoritos") || "[]");
  let currentStreamUrl = "";
  let currentItem = null;
  let pageSize = 20;
  let currentPage = 1;
  let isLoading = false;

  // Elementos DOM
  const header = document.getElementById("header");
  const conteudoDiv = document.getElementById("conteudo");
  const player = document.getElementById("player");
  const playerControls = document.getElementById("player-controls");

  // Event Listeners
  window.addEventListener("scroll", () => {
    header.style.backgroundColor = window.scrollY > 30 ? "rgba(0, 0, 0, 0.9)" : "rgba(0, 0, 0, 1)";
    // Lazy loading no scroll
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
      loadMoreItems();
    }
  });

  document.getElementById("tab-home").addEventListener("click", renderTelaPrincipal);
  document.getElementById("tab-filmes").addEventListener("click", abrirFilmes);
  document.getElementById("tab-series").addEventListener("click", abrirSeries);
  document.getElementById("tab-favoritos").addEventListener("click", abrirFavoritos);

  // Fun√ß√µes do Player
  function playerPlay() { player.play(); }
  function playerPause() { player.pause(); }
  function playerStop() { player.pause(); player.currentTime = 0; }
  function playerBack() { player.currentTime -= 10; }
  function playerForward() { player.currentTime += 10; }

  function exibirPlayer(link, item = null) {
    currentStreamUrl = link;
    currentItem = item;
    player.src = link;
    player.style.display = "block";
    playerControls.style.display = "flex";
    player.play();
    window.scrollTo({ top: 0, behavior: "smooth" });
    if (item) registrarUltimo(item);
  }

  function ocultarPlayer() {
    player.pause();
    player.removeAttribute("src");
    player.load();
    player.style.display = "none";
    playerControls.style.display = "none";
    currentStreamUrl = "";
    currentItem = null;
  }

  // Configura√ß√£o
  function openConfig() {
    document.getElementById("configModal").style.display = "flex";
    document.getElementById("config-url").value = config.url || "";
    document.getElementById("config-user").value = config.user || "";
    document.getElementById("config-pass").value = config.pass || "";
  }

  function closeConfig() {
    document.getElementById("configModal").style.display = "none";
  }

  function saveConfig() {
    config = {
      url: document.getElementById("config-url").value.replace(/\/$/, ""),
      user: document.getElementById("config-user").value,
      pass: document.getElementById("config-pass").value
    };
    localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
    closeConfig();
    renderTelaPrincipal();
  }

  function checkConfig() {
    if (!config.url || !config.user || !config.pass) {
      openConfig();
      return false;
    }
    return true;
  }

  // Cast / Reproduzir na rede
  function openCastModal() {
    if (!currentStreamUrl) {
      alert("Nenhum v√≠deo em reprodu√ß√£o. Selecione um filme ou s√©rie primeiro.");
      return;
    }
    document.getElementById("castModal").style.display = "flex";
  }

  function closeCastModal() {
    document.getElementById("castModal").style.display = "none";
  }

  function castToLocalNetwork() {
    // Abre o stream em uma nova aba/janela que pode ser acessada por dispositivos na rede
    const castWindow = window.open("", "_blank", "width=800,height=600");
    castWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head><title>Cast - LisoFlix</title></head>
      <body style="margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh;">
        <video controls autoplay style="width:100%;height:100%;max-width:100vw;max-height:100vh;">
          <source src="${currentStreamUrl}" type="video/mp4">
        </video>
      </body>
      </html>
    `);
    closeCastModal();
  }

  function copyStreamUrl() {
    navigator.clipboard.writeText(currentStreamUrl).then(() => {
      alert("Link copiado para a √°rea de transfer√™ncia!");
    });
    closeCastModal();
  }

  function generateQR() {
    // Usa API gratuita para gerar QR code
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(currentStreamUrl)}`;
    const qrWindow = window.open("", "_blank", "width=400,height=400");
    qrWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head><title>QR Code - LisoFlix</title></head>
      <body style="text-align:center;background:#141414;color:white;font-family:Arial;">
        <h2>Escaneie para reproduzir</h2>
        <img src="${qrUrl}" style="max-width:300px;" />
        <p style="font-size:12px;word-break:break-all;">${currentStreamUrl}</p>
      </body>
      </html>
    `);
    closeCastModal();
  }

  // Organiza√ß√£o e Lazy Loading
  function organizarPorCategoria(lista) {
    const categorias = {};
    lista.forEach(item => {
      const cat = item.category_name || "Outros";
      if (!categorias[cat]) categorias[cat] = [];
      if (!categorias[cat].some(i => i.name === item.name)) {
        categorias[cat].push(item);
      }
    });
    return categorias;
  }

  function registrarUltimo(item) {
    let ultimos = JSON.parse(localStorage.getItem("ultimos") || "[]");
    ultimos = ultimos.filter(i => i.name !== item.name);
    ultimos.unshift(item);
    if (ultimos.length > 50) ultimos.pop();
    localStorage.setItem("ultimos", JSON.stringify(ultimos));
  }

  function alternarFavorito(item, event) {
    if (event) event.stopPropagation();
    const idx = favoritos.findIndex(i => i.name === item.name);
    if (idx >= 0) favoritos.splice(idx, 1);
    else favoritos.unshift(item);
    localStorage.setItem("favoritos", JSON.stringify(favoritos));
    return idx < 0; // retorna true se adicionou
  }

  function resetarAbas() {
    document.querySelectorAll("nav button").forEach(btn => {
      if (!btn.classList.contains("config-btn")) btn.classList.remove("active");
    });
  }

  // Renderiza√ß√£o com Lazy Loading
  let allItems = [];
  let renderedCount = 0;

  function renderItensLazy(container, items, isFilme = true, append = false) {
    if (!append) {
      container.innerHTML = "";
      allItems = items;
      renderedCount = 0;
    }

    const toRender = allItems.slice(renderedCount, renderedCount + pageSize);
    
    toRender.forEach(item => {
      const el = document.createElement("div");
      el.className = "item";
      const capa = isFilme ? item.stream_icon : item.cover;
      const isFav = favoritos.some(f => f.name === item.name);

      el.innerHTML = `
        <div class="img-container">
          <img loading="lazy" src="${capa || ''}" onerror="this.style.display='none'" alt="${item.name}">
          <span class="fav-btn" title="Favoritar">${isFav ? "‚òÖ" : "‚òÜ"}</span>
        </div>
        <p>${item.name}</p>
      `;

      el.querySelector(".img-container").onclick = () => 
        isFilme 
          ? exibirPlayer(`${streamBase}${item.stream_id}.mp4`, item)
          : abrirSerieDetalhe(item.series_id, item.name);

      el.querySelector(".fav-btn").onclick = (e) => {
        const added = alternarFavorito(item, e);
        e.target.textContent = added ? "‚òÖ" : "‚òÜ";
      };

      container.appendChild(el);
    });

    renderedCount += toRender.length;

    // Adiciona bot√£o "Carregar mais" se houver mais itens
    if (renderedCount < allItems.length) {
      let loadMoreBtn = container.querySelector(".load-more-container");
      if (!loadMoreBtn) {
        loadMoreBtn = document.createElement("div");
        loadMoreBtn.className = "load-more-container";
        loadMoreBtn.style.cssText = "width:100%;text-align:center;padding:20px;";
        container.appendChild(loadMoreBtn);
      }
      loadMoreBtn.innerHTML = `
        <button onclick="loadMoreItems()" style="padding:10px 30px;background:#e50914;color:white;border:none;border-radius:20px;cursor:pointer;">
          Carregar mais (${allItems.length - renderedCount} restantes)
        </button>
      `;
    }
  }

  function loadMoreItems() {
    const container = document.querySelector(".grid") || document.querySelector(".carousel");
    if (container) {
      const isFilme = container.dataset.type === "filmes";
      renderItensLazy(container, allItems, isFilme, true);
    }
  }

  // Telas
  function abrirFilmes() {
    ocultarPlayer();
    resetarAbas();
    document.getElementById("tab-filmes").classList.add("active");
    conteudoDiv.innerHTML = `
      <div style="padding: 20px;">
        <h2 class="category-title">Filmes 
          <button style="padding:8px 16px;background:#333;color:white;border:none;border-radius:4px;cursor:pointer;" onclick="renderTelaPrincipal()">Voltar</button>
        </h2>
      </div>
      <div class="grid" data-type="filmes"></div>
    `;
    const todosFilmes = Object.values(filmes).flat();
    renderItensLazy(conteudoDiv.querySelector(".grid"), todosFilmes, true);
  }

  function abrirSeries() {
    ocultarPlayer();
    resetarAbas();
    document.getElementById("tab-series").classList.add("active");
    conteudoDiv.innerHTML = `
      <div style="padding: 20px;">
        <h2 class="category-title">S√©ries 
          <button style="padding:8px 16px;background:#333;color:white;border:none;border-radius:4px;cursor:pointer;" onclick="renderTelaPrincipal()">Voltar</button>
        </h2>
      </div>
      <div class="grid" data-type="series"></div>
    `;
    const todasSeries = Object.values(series).flat();
    renderItensLazy(conteudoDiv.querySelector(".grid"), todasSeries, false);
  }

  function abrirFavoritos() {
    ocultarPlayer();
    resetarAbas();
    document.getElementById("tab-favoritos").classList.add("active");
    conteudoDiv.innerHTML = `
      <div style="padding: 20px;">
        <h2 class="category-title">Favoritos 
          <button style="padding:8px 16px;background:#333;color:white;border:none;border-radius:4px;cursor:pointer;" onclick="renderTelaPrincipal()">Voltar</button>
        </h2>
      </div>
      <div class="grid" data-type="filmes"></div>
    `;
    renderItensLazy(conteudoDiv.querySelector(".grid"), favoritos, true);
  }

  async function abrirSerieDetalhe(seriesId, seriesName) {
    ocultarPlayer();
    conteudoDiv.innerHTML = `
      <div style="padding: 20px;">
        <h2 class="category-title">${seriesName} 
          <button style="padding:8px 16px;background:#333;color:white;border:none;border-radius:4px;cursor:pointer;" onclick="abrirSeries()">Voltar</button>
        </h2>
        <div id="episodes-list">Carregando epis√≥dios...</div>
      </div>
    `;

    try {
      const token = `username=${config.user}&password=${config.pass}`;
      const response = await fetch(`${config.url}/player_api.php?${token}&action=get_series_info&series_id=${seriesId}`);
      const data = await response.json();

      const episodesList = document.getElementById("episodes-list");
      episodesList.innerHTML = "";

      if (data.episodes && Object.keys(data.episodes).length > 0) {
        for (const seasonNum in data.episodes) {
          const season = data.episodes[seasonNum];
          const seasonDiv = document.createElement("div");
          seasonDiv.innerHTML = `<h3 style="margin: 20px 0 10px; color: #e50914;">Temporada ${seasonNum}</h3>`;
          
          season.forEach(episode => {
            const episodeBtn = document.createElement("button");
            episodeBtn.className = "episodes";
            episodeBtn.textContent = `S${episode.season}E${episode.episode} - ${episode.title}`;
            episodeBtn.onclick = () => exibirPlayer(`${streamBase}${episode.id}.mp4`, episode);
            seasonDiv.appendChild(episodeBtn);
          });
          episodesList.appendChild(seasonDiv);
        }
      } else {
        episodesList.innerHTML = "<p style='text-align: center; color: #808080; padding: 40px;'>Nenhum epis√≥dio encontrado.</p>";
      }
    } catch (e) {
      console.error("Erro:", e);
      conteudoDiv.innerHTML = "<p style='color:#e50914; padding: 20px;'>Erro ao carregar detalhes.</p>";
    }
  }

  async function renderTelaPrincipal() {
    if (!checkConfig()) return;

    ocultarPlayer();
    resetarAbas();
    document.getElementById("tab-home").classList.add("active");
    conteudoDiv.innerHTML = `<div style="text-align: center; padding: 50px;"><div class="loading-spinner"></div></div>`;

    try {
      const token = `username=${config.user}&password=${config.pass}`;
      const filmesPromise = fetch(`${config.url}/player_api.php?${token}&action=get_vod_streams`).then(r => r.json());
      const seriesPromise = fetch(`${config.url}/player_api.php?${token}&action=get_series`).then(r => r.json());

      const [vods, sers] = await Promise.all([filmesPromise, seriesPromise]);

      streamBase = `${config.url}/movie/${config.user}/${config.pass}/`;
      filmes = organizarPorCategoria(vods);
      series = organizarPorCategoria(sers);

      conteudoDiv.innerHTML = "";

      // Hero Banner
      const heroBanner = document.createElement("div");
      heroBanner.className = "hero-banner";
      heroBanner.innerHTML = `
        <div class="hero-content">
          <h1 class="hero-title">LisoFlix Pro</h1>
          <p class="hero-description">Assista aos melhores filmes e s√©ries. Use o bot√£o "üì∫ Reproduzir na TV" para assistir em outros dispositivos.</p>
          <div class="hero-buttons">
            <button class="btn-play" onclick="abrirFilmes()">Assistir Agora</button>
            <button class="btn-info" onclick="abrirSeries()">S√©ries</button>
            <button class="btn-cast" onclick="openCastModal()">üì∫ Reproduzir na TV</button>
          </div>
        </div>
      `;
      conteudoDiv.appendChild(heroBanner);

      // Filmes em Destaque (lazy load)
      if (Object.keys(filmes).length) {
        const secFilmes = document.createElement("div");
        secFilmes.className = "category";
        secFilmes.innerHTML = `<h2>Filmes em Destaque</h2>`;
        const filmesRow = document.createElement("div");
        filmesRow.className = "carousel";
        filmesRow.dataset.type = "filmes";
        
        const todosFilmes = Object.values(filmes).flat();
        renderItensLazy(filmesRow, todosFilmes.slice(0, 50), true); // Primeiros 50
        secFilmes.appendChild(filmesRow);
        conteudoDiv.appendChild(secFilmes);
      }

      // S√©ries em Destaque
      if (Object.keys(series).length) {
        const secSeries = document.createElement("div");
        secSeries.className = "category";
        secSeries.innerHTML = `<h2>S√©ries em Destaque</h2>`;
        const seriesRow = document.createElement("div");
        seriesRow.className = "carousel";
        seriesRow.dataset.type = "series";
        
        const todasSeries = Object.values(series).flat();
        renderItensLazy(seriesRow, todasSeries.slice(0, 50), false);
        secSeries.appendChild(seriesRow);
        conteudoDiv.appendChild(secSeries);
      }

    } catch (e) {
      console.error("Erro:", e);
      conteudoDiv.innerHTML = `
        <div style="text-align:center; padding: 50px; color: #e50914;">
          <p>Erro ao carregar dados. Verifique:</p>
          <ul style="text-align:left; display:inline-block; margin-top:20px;">
            <li>Sua conex√£o com a internet</li>
            <li>As credenciais em Configura√ß√µes (‚öôÔ∏è)</li>
            <li>Se o servidor est√° online</li>
          </ul>
          <br><br>
          <button onclick="openConfig()" style="padding:10px 20px;background:#e50914;color:white;border:none;border-radius:4px;cursor:pointer;">Abrir Configura√ß√µes</button>
        </div>
      `;
    }
  }

  // Iniciar
  renderTelaPrincipal();
</script>

</body>
</html>
