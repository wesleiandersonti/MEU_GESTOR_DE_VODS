<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Checkr M3U</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1f1f1f;
            --bg-card: #252525;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --gradient-1: linear-gradient(135deg, #6366f1, #8b5cf6);
            --gradient-2: linear-gradient(135deg, #10b981, #059669);
            --gradient-3: linear-gradient(135deg, #f59e0b, #d97706);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: var(--gradient-1);
            opacity: 0.05;
            transform: rotate(45deg);
            animation: shimmer 15s infinite linear;
        }
        @keyframes shimmer {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: -1px;
            position: relative;
            z-index: 1;
        }
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
        }
        .url-section {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .url-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }
        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        input[type="text"] {
            flex: 1;
            padding: 15px 20px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-card);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        button {
            padding: 15px 25px;
            background: var(--gradient-1);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.5s ease;
        }
        button:hover::before {
            left: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        button:disabled {
            background: var(--bg-tertiary);
            cursor: not-allowed;
            transform: none;
        }
        .status-message {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .status-success {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid var(--success);
            color: var(--success);
        }
        .status-error {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--error);
            color: var(--error);
        }
        .status-warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
            color: var(--warning);
        }
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-1);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }
        .stat-card:hover::before {
            transform: scaleX(1);
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .stat-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        .server-info {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .server-info h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .info-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .info-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .info-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--accent);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-secondary);
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        .notification-success {
            border-left: 4px solid var(--success);
        }
        .notification-error {
            border-left: 4px solid var(--error);
        }
        .notification-info {
            border-left: 4px solid var(--accent);
        }
        .download-section {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }
        .download-btn {
            padding: 18px 40px;
            font-size: 1.1rem;
            background: var(--gradient-2);
            color: var(--bg-primary);
            font-weight: 700;
            border-radius: 50px;
            position: relative;
            overflow: hidden;
        }
        .download-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .download-btn:hover::after {
            width: 300px;
            height: 300px;
        }
        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(16, 185, 129, 0.3);
        }
        .server-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--success);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: blink 2s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .streams-count {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }
        .streams-count strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .input-group {
                flex-direction: column;
            }
            h1 {
                font-size: 2.5rem;
            }
            .stats-container {
                grid-template-columns: 1fr;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
            .download-section {
                flex-direction: column;
                gap: 15px;
            }
            .download-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dark Checkr M3U</h1>
            <p class="subtitle">Verificador e Extrator de Listas M3U</p>
        </header>
        
        <section class="url-section">
            <div class="input-group">
                <input type="text" id="m3uUrl" placeholder="Cole o link M3U aqui...">
                <button id="verifyBtn">
                    <i class="fas fa-check-circle"></i> Verificar M3U
                </button>
            </div>
            <div id="statusMessage"></div>
            <button id="clearListBtn" style="display: none;">
                <i class="fas fa-trash"></i> Limpar Lista
            </button>
        </section>
        
        <section id="contentSection" class="content-section">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tv"></i>
                    </div>
                    <div class="stat-title">Canais ao Vivo</div>
                    <div class="stat-value" id="liveCount">0</div>
                    <button id="downloadLiveBtn" class="download-btn">
                        <i class="fas fa-download"></i> Baixar Canais
                    </button>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-film"></i>
                    </div>
                    <div class="stat-title">Filmes</div>
                    <div class="stat-value" id="vodCount">0</div>
                    <button id="downloadVodBtn" class="download-btn">
                        <i class="fas fa-download"></i> Baixar Filmes
                    </button>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="stat-title">Séries</div>
                    <div class="stat-value" id="seriesCount">0</div>
                    <button id="downloadSeriesBtn" class="download-btn">
                        <i class="fas fa-download"></i> Baixar Séries
                    </button>
                </div>
            </div>
            
            <div class="server-info">
                <h3>Informações do Servidor</h3>
                <div class="info-grid">
                    <div class="info-card">
                        <div class="info-label">Status</div>
                        <div class="server-status">
                            <span class="status-dot"></span>
                            <span id="serverStatus">Ativo</span>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Streams Disponíveis</div>
                        <div class="info-value" id="totalStreams">0</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Host</div>
                        <div class="info-value" id="serverHost">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Porta</div>
                        <div class="info-value" id="serverPort">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Protocolo</div>
                        <div class="info-value" id="serverProtocol">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Timezone</div>
                        <div class="info-value" id="serverTimezone">UTC</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Usuário</div>
                        <div class="info-value" id="userInfo">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Senha</div>
                        <div class="info-value" id="passInfo">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Conexões</div>
                        <div class="info-value" id="maxConnections">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Criado em</div>
                        <div class="info-value" id="createdDate">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Expira em</div>
                        <div class="info-value" id="expDate">-</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Teste de Conexão</div>
                        <div class="info-value" id="trialStatus">-</div>
                    </div>
                </div>
                <div class="streams-count">
                    <strong id="liveStreamsCount">0</strong> Live • 
                    <strong id="seriesStreamsCount">0</strong> Séries • 
                    <strong id="vodStreamsCount">0</strong> VOD
                </div>
            </div>
            
            <div class="download-section">
                <button id="downloadAllBtn" class="download-btn">
                    <i class="fas fa-download"></i> Baixar Todo o Conteúdo
                </button>
            </div>
        </section>
        
        <!-- Notificação -->
        <div id="notification" class="notification">
            <i class="fas fa-info-circle"></i>
            <span id="notificationMessage"></span>
        </div>
    </div>
    
    <script>
        // Configuração da API Xtream
        const xtreamConfig = {
            baseUrl: '',
            user: '',
            pass: ''
        };
        
        // Cache para armazenar dados
        const cache = {
            live: [],
            vod: {},
            series: {},
            live_cat: [],
            vod_cat: [],
            series_cat: [],
            series_info: {},
            all_vod: [],
            all_series: [],
            userInfo: {}
        };
        
        // Estado da aplicação
        let isLoadingContent = false;
        
        // Elementos do DOM
        const m3uUrlInput = document.getElementById('m3uUrl');
        const verifyBtn = document.getElementById('verifyBtn');
        const clearListBtn = document.getElementById('clearListBtn');
        const statusMessage = document.getElementById('statusMessage');
        const contentSection = document.getElementById('contentSection');
        const liveCount = document.getElementById('liveCount');
        const vodCount = document.getElementById('vodCount');
        const seriesCount = document.getElementById('seriesCount');
        const downloadLiveBtn = document.getElementById('downloadLiveBtn');
        const downloadVodBtn = document.getElementById('downloadVodBtn');
        const downloadSeriesBtn = document.getElementById('downloadSeriesBtn');
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        const serverStatus = document.getElementById('serverStatus');
        const serverHost = document.getElementById('serverHost');
        const serverPort = document.getElementById('serverPort');
        const serverProtocol = document.getElementById('serverProtocol');
        const serverTimezone = document.getElementById('serverTimezone');
        const userInfo = document.getElementById('userInfo');
        const passInfo = document.getElementById('passInfo');
        const maxConnections = document.getElementById('maxConnections');
        const createdDate = document.getElementById('createdDate');
        const expDate = document.getElementById('expDate');
        const trialStatus = document.getElementById('trialStatus');
        const totalStreams = document.getElementById('totalStreams');
        const liveStreamsCount = document.getElementById('liveStreamsCount');
        const seriesStreamsCount = document.getElementById('seriesStreamsCount');
        const vodStreamsCount = document.getElementById('vodStreamsCount');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notificationMessage');
        
        // Event Listeners
        verifyBtn.addEventListener('click', verifyM3U);
        clearListBtn.addEventListener('click', clearList);
        downloadLiveBtn.addEventListener('click', () => downloadPlaylist('live'));
        downloadVodBtn.addEventListener('click', () => downloadPlaylist('vod'));
        downloadSeriesBtn.addEventListener('click', () => downloadPlaylist('series'));
        downloadAllBtn.addEventListener('click', () => downloadPlaylist('all'));
        
        // Função para verificar se o link M3U é válido
        async function verifyM3U() {
            const url = m3uUrlInput.value.trim();
            if (!url) {
                showNotification('Por favor, insira um link M3U', 'error');
                return;
            }
            
            verifyBtn.disabled = true;
            verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            
            try {
                const urlObj = new URL(url);
                const params = new URLSearchParams(urlObj.search);
                
                const user = params.get('username');
                const pass = params.get('password');
                const baseUrl = `${urlObj.protocol}//${urlObj.hostname}${urlObj.port ? ':' + urlObj.port : ''}`;
                
                if (!user || !pass) {
                    throw new Error('Link M3U inválido. Não foi possível extrair usuário e senha.');
                }
                
                xtreamConfig.baseUrl = baseUrl;
                xtreamConfig.user = user;
                xtreamConfig.pass = pass;
                
                const testUrl = `${baseUrl}/player_api.php?username=${user}&password=${pass}&action=user_info`;
                const response = await fetchAPI(testUrl);
                
                if (response && response.user_info) {
                    showStatus('Link M3U verificado com sucesso! O servidor está online.', 'success');
                    clearListBtn.style.display = 'block';
                    
                    // Carregar informações do servidor
                    cache.userInfo = response.user_info;
                    updateServerInfo(urlObj);
                    
                    // Carregar conteúdo
                    await loadContent();
                } else {
                    throw new Error('O servidor respondeu, mas não retornou dados válidos.');
                }
            } catch (error) {
                console.error("Erro ao verificar M3U:", error);
                showStatus(`Erro ao verificar o link M3U: ${error.message}`, 'error');
            } finally {
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> Verificar M3U';
            }
        }
        
        // Função para limpar a lista
        function clearList() {
            cache.live = [];
            cache.vod = {};
            cache.series = {};
            cache.all_vod = [];
            cache.all_series = [];
            cache.live_cat = [];
            cache.vod_cat = [];
            cache.series_cat = {};
            cache.series_info = {};
            cache.userInfo = {};
            
            contentSection.classList.remove('active');
            clearListBtn.style.display = 'none';
            
            m3uUrlInput.value = '';
            
            showNotification('Lista limpa com sucesso!', 'info');
        }
        
        // Função para carregar o conteúdo do servidor
        async function loadContent() {
            if (isLoadingContent) {
                showNotification('Já existe um carregamento em andamento. Aguarde...', 'warning');
                return;
            }
            
            isLoadingContent = true;
            
            try {
                await fetchInitialData();
                contentSection.classList.add('active');
                updateCounts();
                showNotification('Conteúdo carregado com sucesso!', 'success');
            } catch (error) {
                console.error("Erro ao carregar conteúdo:", error);
                showNotification(`Erro ao carregar conteúdo: ${error.message}`, 'error');
            } finally {
                isLoadingContent = false;
            }
        }
        
        // Função principal para carregar dados iniciais
        async function fetchInitialData() {
            const { baseUrl, user, pass } = xtreamConfig;
            const baseApi = `${baseUrl}/player_api.php?username=${user}&password=${pass}`;
            
            try {
                showStatus('Iniciando carregamento de conteúdo...', 'warning');
                
                const [live, live_cat, vod_cat, series_cat] = await Promise.all([
                    fetchAPI(`${baseApi}&action=get_live_streams`),
                    fetchAPI(`${baseApi}&action=get_live_categories`),
                    fetchAPI(`${baseApi}&action=get_vod_categories`),
                    fetchAPI(`${baseApi}&action=get_series_categories`),
                ]);
                
                cache.live_cat = live_cat || [];
                cache.live = live || [];
                
                cache.vod_cat = vod_cat || [];
                cache.series_cat = series_cat || [];
                
                showStatus('Carregando filmes...', 'warning');
                const vodStreams = await fetchAPI(`${baseApi}&action=get_vod_streams`);
                cache.vod = {};
                cache.all_vod = [];
                (vodStreams || []).forEach(item => {
                    if (!cache.vod[item.category_id]) cache.vod[item.category_id] = [];
                    cache.vod[item.category_id].push(item);
                    cache.all_vod.push(item);
                });
                
                showStatus('Carregando séries...', 'warning');
                const seriesStreams = await fetchAPI(`${baseApi}&action=get_series`);
                cache.series = {};
                cache.all_series = [];
                (seriesStreams || []).forEach(item => {
                    if (!item.series_id) item.series_id = item.stream_id;
                    if (!cache.series[item.category_id]) cache.series[item.category_id] = [];
                    cache.series[item.category_id].push(item);
                    cache.all_series.push(item);
                });
                
                showStatus('Processamento concluído!', 'success');
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
                throw error;
            }
        }
        
        // Função para buscar dados da API
        async function fetchAPI(url) {
            const CORS_PROXY = 'https://corsproxy.io/?';
            const REQUEST_TIMEOUT = 30000;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);
            
            try {
                console.log("Fazendo requisição para:", CORS_PROXY + url);
                const response = await fetch(CORS_PROXY + url, { 
                    signal: controller.signal, 
                    cache: 'no-store' 
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`API fetch failed (status ${response.status})`);
                }
                
                const data = await response.json();
                console.log("Resposta da API:", data);
                
                if (data && data.status === 'error') {
                    throw new Error(data.error || 'Erro na API Xtream Codes');
                }
                
                return data || [];
            } catch (e) {
                console.error("Erro na requisição:", e);
                throw e;
            }
        }
        
        // Função para atualizar as informações do servidor
        function updateServerInfo(urlObj) {
            if (cache.userInfo) {
                userInfo.textContent = cache.userInfo.username || '-';
                passInfo.textContent = xtreamConfig.pass || '-';
                maxConnections.textContent = `${cache.userInfo.active_cons || 0} / ${cache.userInfo.max_connections || 1}`;
                trialStatus.textContent = cache.userInfo.is_trial ? 'Sim' : 'Não';
                
                if (cache.userInfo.created_at) {
                    const created = new Date(cache.userInfo.created_at * 1000);
                    createdDate.textContent = created.toLocaleDateString('pt-BR') + ', ' + created.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                }
                
                if (cache.userInfo.exp_date) {
                    const expDateObj = new Date(cache.userInfo.exp_date * 1000);
                    const now = new Date();
                    const diffTime = Math.abs(expDateObj - now);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    expDate.textContent = `${diffDays} dias`;
                }
                
                if (urlObj) {
                    serverHost.textContent = urlObj.hostname || '-';
                    serverPort.textContent = urlObj.port || (urlObj.protocol === 'https:' ? '443' : '80');
                    serverProtocol.textContent = urlObj.protocol.replace(':', '') || '-';
                }
            }
        }
        
        // Função para atualizar os contadores
        function updateCounts() {
            const live = cache.live.length;
            const vod = cache.all_vod.length;
            const series = cache.all_series.length;
            const total = live + vod + series;
            
            liveCount.textContent = live.toLocaleString();
            vodCount.textContent = vod.toLocaleString();
            seriesCount.textContent = series.toLocaleString();
            
            totalStreams.textContent = total.toLocaleString();
            liveStreamsCount.textContent = live.toLocaleString();
            seriesStreamsCount.textContent = series.toLocaleString();
            vodStreamsCount.textContent = vod.toLocaleString();
        }
        
        // Função para formatar a URL do stream
        function formatStreamUrl(item, type) {
            const { baseUrl, user, pass } = xtreamConfig;
            
            if (item.url) {
                return item.url;
            }
            
            if (type === 'live') {
                return `${baseUrl}/live/${user}/${pass}/${item.stream_id}.m3u8`;
            } else if (type === 'vod') {
                return `${baseUrl}/movie/${user}/${pass}/${item.stream_id}.${item.container_extension || 'mp4'}`;
            } else if (type === 'series') {
                if (item.series_id && item.id) {
                    return `${baseUrl}/series/${user}/${pass}/${item.series_id}/${item.id}.${item.container_extension || 'mp4'}`;
                } else {
                    return `${baseUrl}/series/${user}/${pass}/${item.stream_id}.${item.container_extension || 'mp4'}`;
                }
            }
            
            return '';
        }
        
        // Função para baixar playlist
        function downloadPlaylist(type) {
            let playlistContent = `#EXTM3U\n`;
            let playlistName = 'Dark Checkr M3U';
            
            switch (type) {
                case 'live':
                    playlistName = 'Dark Checkr - Canais ao Vivo';
                    playlistContent += `#EXTINF:-1,${playlistName}\n\n`;
                    
                    cache.live.forEach(item => {
                        const logo = item.stream_icon || '';
                        const streamUrl = formatStreamUrl(item, 'live');
                        playlistContent += `#EXTINF:-1 tvg-logo="${logo}" group-title="Canais ao Vivo",${item.name}\n`;
                        playlistContent += `${streamUrl}\n\n`;
                    });
                    break;
                    
                case 'vod':
                    playlistName = 'Dark Checkr - Filmes';
                    playlistContent += `#EXTINF:-1,${playlistName}\n\n`;
                    
                    cache.all_vod.forEach(item => {
                        const logo = item.stream_icon || item.cover || '';
                        const streamUrl = formatStreamUrl(item, 'vod');
                        playlistContent += `#EXTINF:-1 tvg-logo="${logo}" group-title="Filmes",${item.name}\n`;
                        playlistContent += `${streamUrl}\n\n`;
                    });
                    break;
                    
                case 'series':
                    playlistName = 'Dark Checkr - Séries';
                    playlistContent += `#EXTINF:-1,${playlistName}\n\n`;
                    
                    cache.all_series.forEach(item => {
                        const logo = item.stream_icon || item.cover || '';
                        const streamUrl = formatStreamUrl(item, 'series');
                        playlistContent += `#EXTINF:-1 tvg-logo="${logo}" group-title="Séries",${item.name}\n`;
                        playlistContent += `${streamUrl}\n\n`;
                    });
                    break;
                    
                case 'all':
                    playlistName = 'Dark Checkr - Conteúdo Completo';
                    playlistContent += `#EXTINF:-1,${playlistName}\n\n`;
                    
                    // Adicionar canais ao vivo
                    cache.live.forEach(item => {
                        const logo = item.stream_icon || '';
                        const streamUrl = formatStreamUrl(item, 'live');
                        playlistContent += `#EXTINF:-1 tvg-logo="${logo}" group-title="Canais ao Vivo",${item.name}\n`;
                        playlistContent += `${streamUrl}\n\n`;
                    });
                    
                    // Adicionar filmes
                    cache.all_vod.forEach(item => {
                        const logo = item.stream_icon || item.cover || '';
                        const streamUrl = formatStreamUrl(item, 'vod');
                        playlistContent += `#EXTINF:-1 tvg-logo="${logo}" group-title="Filmes",${item.name}\n`;
                        playlistContent += `${streamUrl}\n\n`;
                    });
                    
                    // Adicionar séries
                    cache.all_series.forEach(item => {
                        const logo = item.stream_icon || item.cover || '';
                        const streamUrl = formatStreamUrl(item, 'series');
                        playlistContent += `#EXTINF:-1 tvg-logo="${logo}" group-title="Séries",${item.name}\n`;
                        playlistContent += `${streamUrl}\n\n`;
                    });
                    break;
            }
            
            const blob = new Blob([playlistContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${playlistName.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.m3u`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(`Playlist "${playlistName}" baixada com sucesso!`, 'success');
        }
        
        // Função para mostrar status
        function showStatus(message, type) {
            statusMessage.innerHTML = `
                <div class="status-message status-${type}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                </div>
            `;
        }
        
        // Função para mostrar notificação
        function showNotification(message, type = 'info') {
            notification.className = `notification notification-${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>